;/*FB_PKG_DELIM*/

__d("WAWebBroadcastListIdUtils",["WAJids"],(function(t,n,r,o,a,i,l){function e(e){for(var t=Math.floor(Date.now()/1e3);e(o("WAJids").toBroadcastJid(String(t)));)t++;return o("WAJids").toBroadcastJid(String(t))}function s(e){if(e.length<1||e.length>20)return!1;var t=e.charAt(0);if(t<"1"||t>"9")return!1;for(var n=0;n<e.length;n++){var r=e.charAt(n);if(r<"0"||r>"9")return!1}return!0}l.createBroadcastListJid=e,l.isValidBroadcastListId=s}),98);
__d("WAWebBroadcastListStorageUtils",["WAWebBizGatingUtils","WAWebBroadcastMetadataCollection","WAWebChatCollection","WAWebSyncdCoreApi","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){function e(e,t){return s.apply(this,arguments)}function s(){return s=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var a=e.id,i=e.listName,l=e.participants,s=e.labelIds,u=s===void 0?[]:s,c=e.timestamp,d=o("WAWebWidFactory").createWid(a),m=babelHelpers.extends({name:i,id:d},c!=null?{t:c}:null);yield o("WAWebSyncdCoreApi").lockForSync(["chat","broadcast-metadata"],t!=null?t:[],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e[0],n=e[1];o("WAWebBizGatingUtils").isBizBroadcastSendWebEnabled()&&(yield t.createOrMerge(a,babelHelpers.extends({},m,{id:a})),yield n.createOrReplace({id:a,recipients:l.map(function(e){return e.lidJid}),labels:u}))});return function(t){return e.apply(this,arguments)}})()),o("WAWebBizGatingUtils").isBizBroadcastSendWebEnabled()&&(o("WAWebChatCollection").ChatCollection.gadd(babelHelpers.extends({},m)),r("WAWebBroadcastMetadataCollection").gadd({id:d,labels:u,recipients:l.map(function(e){return{id:o("WAWebWidFactory").createWid(e.lidJid)}})}))}),s.apply(this,arguments)}function u(e,t){return c.apply(this,arguments)}function c(){return c=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){var a=typeof e=="string"?e:e.toString(),i=typeof e=="string"?o("WAWebWidFactory").createWid(e):e;yield o("WAWebSyncdCoreApi").lockForSync(["chat","broadcast-metadata"],t!=null?t:[],(function(){var e=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var t=e[0],n=e[1];yield t.remove(a),yield n.remove(a)});return function(t){return e.apply(this,arguments)}})()),o("WAWebChatCollection").ChatCollection.remove(i),r("WAWebBroadcastMetadataCollection").remove(i)}),c.apply(this,arguments)}l.updateBroadcastListStorage=e,l.removeBroadcastListStorage=u}),98);
__d("WAWebBroadcastListSync",["Promise","WALogger","WASyncdConst","WAWebBizGatingUtils","WAWebBroadcastListStorageUtils","WAWebProtobufsServerSync.pb","WAWebSyncdAction","WAWebSyncdActionUtils","WAWebSyncdIndexUtils","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u,c=(function(t){function r(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r))||this,e.collectionName=o("WASyncdConst").CollectionName.Regular,babelHelpers.assertThisInitialized(e)||babelHelpers.assertThisInitialized(e)}babelHelpers.inheritsLoose(r,t);var a=r.prototype;return a.getVersion=function(){return 1},a.getAction=function(){return o("WASyncdConst").Actions.BusinessBroadcastList},a.applyMutations=(function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){var r=this;return(u||(u=n("Promise"))).all(t.map((function(){var t=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t){try{var n=t.indexParts,a=n[1];if(!a)return o("WAWebSyncdIndexUtils").malformedActionIndex(r.collectionName);if(!o("WAWebBizGatingUtils").isBizBroadcastSendWebEnabled())return{actionState:o("WASyncdConst").SyncActionState.Unsupported};switch(t.operation){case"set":{var i=t.value,l=i.businessBroadcastListAction;if(!l)return o("WALogger").WARN(e||(e=babelHelpers.taggedTemplateLiteralLoose(["broadcast list sync: malformed mutation"]))),o("WAWebSyncdIndexUtils").malformedActionValue(r.collectionName);var u=l.participants,c=l.listName,d=l.labelIds;return yield o("WAWebBroadcastListStorageUtils").updateBroadcastListStorage({id:a,listName:c!=null?c:"",participants:u!=null?u:[],labelIds:d!=null?d:[]}),{actionState:o("WASyncdConst").SyncActionState.Success}}case"remove":return yield o("WAWebBroadcastListStorageUtils").removeBroadcastListStorage(a),{actionState:o("WASyncdConst").SyncActionState.Success};default:return o("WALogger").WARN(s||(s=babelHelpers.taggedTemplateLiteralLoose(["broadcast list sync: operation not supported"]))),{actionState:o("WASyncdConst").SyncActionState.Unsupported}}}catch(e){return{actionState:o("WASyncdConst").SyncActionState.Failed}}});return function(e){return t.apply(this,arguments)}})()))});function r(e){return t.apply(this,arguments)}return r})(),a.getBroadcastListMutation=function(t,n,r,a){var e={businessBroadcastListAction:{participants:n,listName:r,labelIds:[]}};return o("WAWebSyncdActionUtils").buildPendingMutation({action:this.getAction(),indexArgs:[t],collection:this.collectionName,value:e,version:this.getVersion(),operation:o("WAWebProtobufsServerSync.pb").SyncdMutation$SyncdOperation.SET,timestamp:a})},a.getDeleteBroadcastListMutation=function(t,n){return o("WAWebSyncdActionUtils").buildPendingMutation({action:this.getAction(),indexArgs:[t],collection:this.collectionName,value:{},version:this.getVersion(),operation:o("WAWebProtobufsServerSync.pb").SyncdMutation$SyncdOperation.REMOVE,timestamp:n})},r})(o("WAWebSyncdAction").AccountSyncdActionBase),d=new c;l.default=d}),98);
__d("WAWebBroadcastListAction",["WALogger","WATimeUtils","WAWebBizGatingUtils","WAWebBroadcastListIdUtils","WAWebBroadcastListStorageUtils","WAWebBroadcastListSync","WAWebChatCollection","WAWebWidFactory","asyncToGeneratorRuntime"],(function(t,n,r,o,a,i,l){var e,s,u="update",c="delete";function d(e,t,n){return m.apply(this,arguments)}function m(){return m=n("asyncToGeneratorRuntime").asyncToGenerator(function*(t,n,a){if(n.length!==0){var i=o("WATimeUtils").unixTime();try{var l=r("WAWebBroadcastListSync").getBroadcastListMutation(t,n,a,i);yield o("WAWebBroadcastListStorageUtils").updateBroadcastListStorage({id:t,listName:a,participants:n,labelIds:[],timestamp:i},[l])}catch(t){throw o("WALogger").ERROR(e||(e=babelHelpers.taggedTemplateLiteralLoose(["editBroadcastListAction: failed to "," broadcast list with error ",""])),u,t),t}}}),m.apply(this,arguments)}function p(e){return _.apply(this,arguments)}function _(){return _=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e){if(o("WAWebBizGatingUtils").isBizBroadcastSendWebEnabled()){var t=o("WATimeUtils").unixTime();try{var n=r("WAWebBroadcastListSync").getDeleteBroadcastListMutation(e,t);yield o("WAWebBroadcastListStorageUtils").removeBroadcastListStorage(e,[n])}catch(e){throw o("WALogger").ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["deleteBroadcastListAction: failed to "," broadcast list with error ",""])),c,e),e}}}),_.apply(this,arguments)}function f(e,t,n){return g.apply(this,arguments)}function g(){return g=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t,n){return d(e,t,n)}),g.apply(this,arguments)}function h(e,t){return y.apply(this,arguments)}function y(){return y=n("asyncToGeneratorRuntime").asyncToGenerator(function*(e,t){t===void 0&&(t="");var n=e.flatMap(function(e){var t,n,r=(t=e.phoneNumber)==null?void 0:t.toString(),o=(n=e.getCurrentLidContact())==null?void 0:n.id.toString();if(o==null)return[];var a={lidJid:o,pnJid:r};return[a]}),r=o("WAWebBroadcastListIdUtils").createBroadcastListJid(function(e){var t=o("WAWebWidFactory").createWid(e);return o("WAWebChatCollection").ChatCollection.get(t)!=null});return yield f(r,n,t),r}),y.apply(this,arguments)}l.deleteBroadcastListAction=p,l.addBroadcastListAction=f,l.addBroadcastList=h}),98);